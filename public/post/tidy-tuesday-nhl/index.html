<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#9DB5B2">
	<meta name="msapplication-TileColor" content="#9DB5B2">
<meta itemprop="name" content="Tidy Tuesday NHL">
<meta itemprop="description" content="Okay, here it is. My first contribution to the my website. I’ll try to make a very quick and simple data exploration analysis for this weeks’ Tidy Tuesday. There are three datasets available. I’m not sure that I’ll be able to analyze all of them… Let’s start from the first top_250.
library(tidyverse)library(atslib)library(extrafont)library(hrbrthemes)theme_set(hrbrthemes::theme_ft_rc(base_family = &quot;Ubuntu Condensed&quot;))top_250 &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-03/top_250.csv&#39;)top_250## # A tibble: 251 x 9## raw_rank player years total_goals url_number raw_link link active yr_start## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;## 1 1 Wayne ~ 1979~ 894 1 /player~ https~ Retir~ 1979## 2 2 Gordie~ 1946~ 801 2 /player~ https~ Retir~ 1946## 3 3 Jaromi~ 1990~ 766 3 /player~ https~ Retir~ 1990## 4 4 Brett ~ 1986~ 741 4 /player~ https~ Retir~ 1986## 5 5 Marcel~ 1971~ 731 5 /player~ https~ Retir~ 1971## 6 6 Phil E~ 1963~ 717 6 /player~ https~ Retir~ 1963## 7 7 Mike G~ 1979~ 708 7 /player~ https~ Retir~ 1979## 8 8 Alex O~ 2005~ 700 8 /player~ https~ Active 2005## 9 9 Mark M~ 1979~ 694 9 /player~ https~ Retir~ 1979## 10 10 Steve ~ 1983~ 692 10 /player~ https~ Retir~ 1983## # .">
<meta itemprop="datePublished" content="2020-03-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-03-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="908">



<meta itemprop="keywords" content="Tidy Tuesday,R," /><meta property="og:title" content="Tidy Tuesday NHL" />
<meta property="og:description" content="Okay, here it is. My first contribution to the my website. I’ll try to make a very quick and simple data exploration analysis for this weeks’ Tidy Tuesday. There are three datasets available. I’m not sure that I’ll be able to analyze all of them… Let’s start from the first top_250.
library(tidyverse)library(atslib)library(extrafont)library(hrbrthemes)theme_set(hrbrthemes::theme_ft_rc(base_family = &quot;Ubuntu Condensed&quot;))top_250 &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-03/top_250.csv&#39;)top_250## # A tibble: 251 x 9## raw_rank player years total_goals url_number raw_link link active yr_start## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;## 1 1 Wayne ~ 1979~ 894 1 /player~ https~ Retir~ 1979## 2 2 Gordie~ 1946~ 801 2 /player~ https~ Retir~ 1946## 3 3 Jaromi~ 1990~ 766 3 /player~ https~ Retir~ 1990## 4 4 Brett ~ 1986~ 741 4 /player~ https~ Retir~ 1986## 5 5 Marcel~ 1971~ 731 5 /player~ https~ Retir~ 1971## 6 6 Phil E~ 1963~ 717 6 /player~ https~ Retir~ 1963## 7 7 Mike G~ 1979~ 708 7 /player~ https~ Retir~ 1979## 8 8 Alex O~ 2005~ 700 8 /player~ https~ Active 2005## 9 9 Mark M~ 1979~ 694 9 /player~ https~ Retir~ 1979## 10 10 Steve ~ 1983~ 692 10 /player~ https~ Retir~ 1983## # ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/tidy-tuesday-nhl/" />
<meta property="article:published_time" content="2020-03-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-03-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tidy Tuesday NHL"/>
<meta name="twitter:description" content="Okay, here it is. My first contribution to the my website. I’ll try to make a very quick and simple data exploration analysis for this weeks’ Tidy Tuesday. There are three datasets available. I’m not sure that I’ll be able to analyze all of them… Let’s start from the first top_250.
library(tidyverse)library(atslib)library(extrafont)library(hrbrthemes)theme_set(hrbrthemes::theme_ft_rc(base_family = &quot;Ubuntu Condensed&quot;))top_250 &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-03/top_250.csv&#39;)top_250## # A tibble: 251 x 9## raw_rank player years total_goals url_number raw_link link active yr_start## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;## 1 1 Wayne ~ 1979~ 894 1 /player~ https~ Retir~ 1979## 2 2 Gordie~ 1946~ 801 2 /player~ https~ Retir~ 1946## 3 3 Jaromi~ 1990~ 766 3 /player~ https~ Retir~ 1990## 4 4 Brett ~ 1986~ 741 4 /player~ https~ Retir~ 1986## 5 5 Marcel~ 1971~ 731 5 /player~ https~ Retir~ 1971## 6 6 Phil E~ 1963~ 717 6 /player~ https~ Retir~ 1963## 7 7 Mike G~ 1979~ 708 7 /player~ https~ Retir~ 1979## 8 8 Alex O~ 2005~ 700 8 /player~ https~ Active 2005## 9 9 Mark M~ 1979~ 694 9 /player~ https~ Retir~ 1979## 10 10 Steve ~ 1983~ 692 10 /player~ https~ Retir~ 1983## # ."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Tidy Tuesday NHL</title>
	<link rel="stylesheet" href="/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css" integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin="anonymous">
	
	<link rel="stylesheet" href="/css/foo.css">
	<link rel="stylesheet" href="/css/bar.css">
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="/">Anatoly Tsyplenkov</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="/post/">Posts</a>
				<a href="/about-me/">About</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://twitter.com/atsyplen" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://stackoverflow.com/users/9300556/atsyplenkov" target="_blank" rel="noopener me" title="Stackoverflow"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.913 16.041v6.848h17.599v-6.848M7.16 18.696h8.925M7.65 13.937l8.675 1.8M9.214 9.124l8.058 3.758M12.086 4.65l6.849 5.66M15.774 1.111l5.313 7.162"/></svg></a><a href="https://github.com/atsyplenkov" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="mailto:atsyplenkov@gmail.com" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="/post/">Posts</a></li>
			<li><a href="/about-me/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>Tidy Tuesday NHL</h1>
		<div class="content">
			


<p>Okay, here it is. My first contribution to the my website. I’ll try to make a very quick and simple data exploration analysis for this weeks’ <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-03-03/readme.md">Tidy Tuesday</a>. There are three datasets available. I’m not sure that I’ll be able to analyze all of them… Let’s start from the first <code>top_250</code>.</p>
<pre class="r"><code>library(tidyverse)
library(atslib)
library(extrafont)
library(hrbrthemes)
theme_set(hrbrthemes::theme_ft_rc(base_family = &quot;Ubuntu Condensed&quot;))

top_250 &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-03/top_250.csv&#39;)

top_250</code></pre>
<pre><code>## # A tibble: 251 x 9
##    raw_rank player  years total_goals url_number raw_link link   active yr_start
##       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
##  1        1 Wayne ~ 1979~         894          1 /player~ https~ Retir~     1979
##  2        2 Gordie~ 1946~         801          2 /player~ https~ Retir~     1946
##  3        3 Jaromi~ 1990~         766          3 /player~ https~ Retir~     1990
##  4        4 Brett ~ 1986~         741          4 /player~ https~ Retir~     1986
##  5        5 Marcel~ 1971~         731          5 /player~ https~ Retir~     1971
##  6        6 Phil E~ 1963~         717          6 /player~ https~ Retir~     1963
##  7        7 Mike G~ 1979~         708          7 /player~ https~ Retir~     1979
##  8        8 Alex O~ 2005~         700          8 /player~ https~ Active     2005
##  9        9 Mark M~ 1979~         694          9 /player~ https~ Retir~     1979
## 10       10 Steve ~ 1983~         692         10 /player~ https~ Retir~     1983
## # ... with 241 more rows</code></pre>
<p>This dataset contains 250 NHL &amp; WHA career leaders and records for goals. First, we’re going to tidy our dataset a bit. What is the most interesting here is total goals really depends on the career length?</p>
<p>The information about years of career contains in <code>years</code> variable. It has a structure of <code>YYYY-YY</code>. First of all, let split it to <code>year_start</code> and <code>year_end</code>.</p>
<pre class="r"><code>tidy_250 &lt;- top_250 %&gt;% 
  mutate(year_start = str_split(years, &quot;-&quot;, simplify = T)[,1],
         year_end = str_split(years, &quot;-&quot;, simplify = T)[,2]) %&gt;% 
  mutate_at(vars(year_start), ~as.numeric(.)) %&gt;% 
  mutate(century = ifelse(year_start &lt; 2000, 19, 20),
         cc = str_split(year_start, 
                        as.character(century),
                        simplify = T)[,2],
         cc = as.numeric(cc)) %&gt;%
  mutate(year_end = case_when(year_end &gt; cc ~ paste0(19, year_end),
                              TRUE ~ paste0(20, year_end))) %&gt;% 
  mutate_at(vars(year_start, year_end), ~as.numeric(.)) %&gt;% 
  # We need to edit millenials ))
  mutate(year_end = ifelse(year_end &lt; year_start,
                           year_end + 100,
                           year_end)) %&gt;% 
  select(player, total_goals, year_start, year_end) 

tidy_250</code></pre>
<pre><code>## # A tibble: 251 x 4
##    player        total_goals year_start year_end
##    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 Wayne Gretzky         894       1979     1999
##  2 Gordie Howe           801       1946     1980
##  3 Jaromir Jagr          766       1990     2018
##  4 Brett Hull            741       1986     2006
##  5 Marcel Dionne         731       1971     1989
##  6 Phil Esposito         717       1963     1981
##  7 Mike Gartner          708       1979     1998
##  8 Alex Ovechkin         700       2005     2020
##  9 Mark Messier          694       1979     2004
## 10 Steve Yzerman         692       1983     2006
## # ... with 241 more rows</code></pre>
<p>Great! Now we have a very tidy dataframe. However, if we are going to plot career length of all 250 players, it can be a total mess on the plot. Let’s select only first 50 players using <code>dplyr::top_()</code>.</p>
<pre class="r"><code>tidy_50 &lt;- tidy_250 %&gt;% 
  top_n(50, total_goals)</code></pre>
<p>I prefer to use discrete color scale instead of continuous. So I’m going to convert <code>total_goals</code> into factor. I really like to do it interactively with a new <a href="https://juba.github.io/questionr/reference/icut.html">questionr</a> package! So easy!</p>
<pre class="r"><code>## Cutting tidy_50$total_goals into tidy_50$total_goals_rec
tidy_50$total_goals_rec &lt;- cut(tidy_50$total_goals,
                               include.lowest=TRUE,  right=TRUE,
                               breaks = c(400, 500, 600, 700, 800, 900),
                               labels = c(&quot;400-500&quot;,
                                          &quot;500-600&quot;,
                                          &quot;600-700&quot;,
                                          &quot;700-800&quot;,
                                          &quot;800-900&quot;))</code></pre>
<p>Okay, so everything is ready for a plot! Please, notice, that I’ve already set the <code>ggplot</code> theme in the first <code>r</code> chunk via <code>theme_set</code>. I prefer to use dark themes everywhere so for this post I’ll also use a dark one. Bob Rudis (<a href="https://twitter.com/hrbrmstr">hrbrmstr</a>) has created a really nice one in his <a href="https://github.com/hrbrmstr/hrbrthemes">hrbrthemes</a>.</p>
<pre class="r"><code>library(ggalt)
library(paletteer)

tidy_50 %&gt;% 
  mutate(len = year_end - year_start) %&gt;% 
  mutate(player = fct_reorder(player, year_start)) %&gt;%
  ggplot(aes(x = year_start,
             xend = year_end,
             y = player,
             group = player)) + 
  ggalt::geom_dumbbell(aes(color = total_goals_rec),
                size_x = 1.3,
                size_xend = 1.3,
                size = 1) +
  labs(x = &quot;Years active&quot;, y = &quot;&quot;,
       title = &quot;NHL Career Leaders and Records for Goals&quot;,
       subtitle = &quot;TOP 50&quot;,
       caption = &quot;Made by @atsyplen as a #TidyTuesday contribution&quot;) +
  paletteer::scale_color_paletteer_d(name = &quot;Total goals:&quot;,
                                     &quot;wesanderson::Zissou1&quot;) +
  theme(panel.grid.major.y = element_blank())</code></pre>
<p><img src="/post/2020-03-04-tidy-tuesday-nhl_files/figure-html/plot-1.png" width="576" /></p>
<p>Let’s create a bit more meaningful plot. It’s very interesting how <code>total_goals</code> are spread inside career lengths groups! For this one I’d prefer a boxlplot.</p>
<pre class="r"><code>tidy_250 %&gt;% 
  mutate(len = year_end - year_start) %&gt;% 
  mutate(len = cut(len,
                   include.lowest=TRUE,  right=TRUE,
                   breaks = c(5, 10, 15, 20, 25, 30, 35, 40),
                   labels = c(
                     &quot;5-10&quot;,
                     &quot;10-15&quot;,
                     &quot;15-20&quot;,
                     &quot;20-25&quot;,
                     &quot;25-30&quot;,
                     &quot;30-35&quot;,
                     &quot;35-40&quot;
                   ))) %&gt;% 
  group_by(len) %&gt;% 
  mutate(outlier.high = total_goals &gt; quantile(total_goals, .75, na.rm = T) + 1.50*IQR(total_goals, na.rm = T),
         outlier.low = total_goals &lt; quantile(total_goals, .25, na.rm = T) - 1.50*IQR(total_goals, na.rm = T),
         outlier.color = case_when(outlier.high ~ &quot;red&quot;,
                                   outlier.low ~ &quot;steelblue&quot;,
                                   outlier.low == F | outlier.high == F ~ &quot;black&quot;)) %&gt;%
  ggplot(aes(x = len, y = total_goals)) +
  stat_boxplot(geom =&#39;errorbar&#39;,
               width = .25,
               color = &quot;white&quot;) +
  geom_boxplot(outlier.shape = NA,
               color = &quot;white&quot;,
               fill = &quot;white&quot;,
               alpha = .3) +
  geom_jitter(aes(color = outlier.color),
              width = .1,
              alpha = .6,
              show.legend = F) +
  scale_y_continuous(breaks = seq(100, 900, 100),
                     labels = seq(100, 900, 100)) +
  ggrepel::geom_text_repel(data = . %&gt;% group_by(len) %&gt;% 
                             filter(total_goals == max(total_goals)),
                           aes(label = player), segment.colour = &quot;white&quot;,
                           color = &quot;white&quot;, family = &quot;Ubuntu Condensed&quot;) +
  ggsci::scale_color_lancet() +
  labs(y = &quot;Total goals scored in career&quot;,
       x = &quot;Career length, years&quot;,
       title = &quot;NHL Career Leaders and Records for Goals&quot;,
       subtitle = &quot;TOP 250&quot;,
       caption = &quot;Made by @atsyplen as a #TidyTuesday contribution&quot;) +
  theme(panel.grid.major.x = element_blank())</code></pre>
<p><img src="/post/2020-03-04-tidy-tuesday-nhl_files/figure-html/boxplot-1.png" width="672" /></p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2020 <a href="/">Anatoly Tsyplenkov</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
	</footer>



	<script src="/js/main.min.35ccbf1cdceb91e4c64c06b5d009d6e2977fafe56beda7762febd4e67528d2ac.js" integrity="sha256-Ncy/HNzrkeTGTAa10AnW4pd/r+Vr7ad2L+vU5nUo0qw=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-159121305-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
